<!doctype html>
<html>
  <head>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          Inter,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        font-size: 12px;
        color: #333;
        padding: 16px;
        background: #fff;
      }

      h2 {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      p {
        color: #666;
        margin-bottom: 12px;
        line-height: 1.5;
      }

      .instructions {
        background: #f5f5f5;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 16px;
      }

      .instructions ol {
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 4px;
      }

      textarea {
        width: 100%;
        height: 100px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: monospace;
        font-size: 11px;
        resize: vertical;
        margin-bottom: 12px;
      }

      textarea:focus {
        outline: none;
        border-color: #0d99ff;
        box-shadow: 0 0 0 2px rgba(13, 153, 255, 0.1);
      }

      .buttons {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
      }

      button {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
      }

      .btn-primary {
        background: #0d99ff;
        color: white;
        border: none;
      }

      .btn-primary:hover {
        background: #0b87e0;
      }

      .btn-primary:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: #fff;
        color: #333;
        border: 1px solid #ddd;
      }

      .btn-secondary:hover {
        background: #f5f5f5;
      }

      .success {
        color: #22c55e;
        font-weight: 500;
      }

      .error {
        color: #ef4444;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <h2>Import XDesign JSON</h2>

    <div class="instructions">
      <ol>
        <li>In XDesign, click <strong>"Download Figma JSON"</strong></li>
        <li>Open the downloaded JSON file</li>
        <li>Copy all contents (Ctrl+A, Ctrl+C)</li>
        <li>Paste below and click Import</li>
      </ol>
    </div>

    <textarea
      id="jsonInput"
      placeholder="Paste XDesign JSON here..."
    ></textarea>

    <div class="buttons">
      <button class="btn-secondary" onclick="cancel()">Cancel</button>
      <button class="btn-primary" id="importBtn" onclick="importJson()">
        Import
      </button>
    </div>

    <script>
      const textarea = document.getElementById("jsonInput");
      const importBtn = document.getElementById("importBtn");

      // Enable/disable import button based on input
      textarea.addEventListener("input", () => {
        importBtn.disabled = !textarea.value.trim();
      });

      function importJson() {
        const json = textarea.value.trim();
        if (!json) return;

        // Validate it's valid JSON
        try {
          const parsed = JSON.parse(json);
          if (parsed.type !== "XDESIGN_FIGMA_EXPORT") {
            alert(
              "This doesn't look like an XDesign export. Make sure you copied the correct file.",
            );
            return;
          }
        } catch (e) {
          alert(
            "Invalid JSON format. Make sure you copied the entire file contents.",
          );
          return;
        }

        // Send to plugin
        parent.postMessage(
          { pluginMessage: { type: "import-json", json } },
          "*",
        );
      }

      function cancel() {
        parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
      }

      // Handle paste event for convenience
      textarea.addEventListener("paste", () => {
        setTimeout(() => {
          importBtn.disabled = !textarea.value.trim();
        }, 0);
      });

      // Allow Ctrl+Enter to import
      textarea.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
          importJson();
        }
      });
    </script>
  </body>
</html>
